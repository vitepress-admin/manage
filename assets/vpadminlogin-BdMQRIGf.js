import{d as Z,h as x,C as ee,r as d,D as te,b as oe,o as u,c as m,m as n,G as ae,p as o,q as a,y as c,t as r,w as le,A as k,F,z as se,i as M,e as U,H as ne,I as R,J as re,K as ie,L as ue,u as de,a as ce,M as me,N as pe,O as ge,E as N,x as fe,P as ve,Q as be,R as _e,S as we,v as ye,T as ke,_ as he}from"./index-W4JQoyRu.js";/* empty css                */import{E as Ee,a as Ie}from"./el-form-item-CsrfjOy3.js";import{E as Ce}from"./el-checkbox-DUug-yfp.js";import{a as $e}from"./auth-BcfEkeso.js";import{E as Se}from"./index-CNaJdHAJ.js";import"./_baseClone-B6j-wkHS.js";import"./_initCloneObject-CEE6Jjm5.js";const Ve={class:"login-container"},Le={class:"top-bar"},Fe={class:"login"},Me={class:"title"},Ue={class:"social-buttons"},Te={class:"divider"},qe={class:"text-center"},Re=["src"],Ne={key:0},Be={key:1},Ge={class:"text-center-forgot-password"},Pe={class:"text-center"},We={class:"el-login-footer"},De=Z({__name:"vpadminlogin",setup(He){const{t:g}=x(),B=ee(),v=de(),G=ce(),h=d(!1),l=d({tenantId:"000001",username:"",password:"",rememberMe:!1,code:"",uuid:"",clientId:"436efb388d684aadab73ef3cbba8f287",grantType:"vpadminPassword",redirect:window.location.href}),P={username:[{required:!0,trigger:"blur",message:g("pleaseEnterEmail")}],password:[{required:!0,trigger:"blur",message:g("pleaseEnterPassword")}],code:[{required:!0,trigger:"change",message:g("pleaseEnterVerificationCode")}]},W=!1,b=d(""),_=d(!1),w=d(!0),T=d(),E=d(!1),D=d(W),f=d([]),I=d("/");te(()=>v.currentRoute.value,t=>{I.value=t.query&&t.query.redirect?decodeURIComponent(t.query.redirect):I.value||"/"},{immediate:!0});const H=()=>{window.open("https://www.vpadmin.org","_blank")},K=()=>{v.push("/recovery")},C=()=>{var t;(t=T.value)==null||t.validate(async e=>{if(e){_.value=!0,l.value.rememberMe?(localStorage.setItem("username",String(l.value.username)),localStorage.setItem("password",String(l.value.password)),localStorage.setItem("rememberMe",String(l.value.rememberMe))):(localStorage.removeItem("username"),localStorage.removeItem("password"),localStorage.removeItem("rememberMe"));const[i]=await ke(B.login(l.value));if(i)w.value&&await $();else{const S=I.value||"/";await v.push(S)}_.value=!1}})},q=async()=>{E.value=!0,await $()},O=()=>{E.value=!1,b.value=""},$=async()=>{const t=await me(),{data:e}=t;w.value=e.captchaEnabled===void 0?!0:e.captchaEnabled,w.value&&(b.value="data:image/gif;base64,"+e.img,l.value.uuid=e.uuid)},A=async()=>{const{data:t}=await pe();if(t.tenantEnabled&&(f.value=t.voList,f.value&&f.value.length>0)){const e=f.value.find(i=>i.tenantId==="000001");e&&(l.value.tenantId=e.tenantId)}},y=async t=>{h.value=!0;try{const e=await $e(t,l.value.tenantId||"000001");e.code===ge.SUCCESS?window.location.href=e.data:N.error(g("loginFailed",{message:e.msg}))}catch(e){N.error(g("loginFailed",{message:e.message||"Unknown error"}))}finally{h.value=!1}},z=()=>{v.push("/register")};return oe(()=>{G.query.showEmail==="true"&&q(),A()}),(t,e)=>{const i=fe,S=ve,J=be,p=Ee,V=_e,L=we,Q=Ce,Y=Ie,j=Se,X=ye;return u(),m("div",Ve,[n("div",Le,[e[9]||(e[9]=n("a",{href:"https://www.vpadmin.org",target:"_blank",class:"logo-link"},[n("img",{src:ae,alt:"Vpadmin Logo",class:"logo"})],-1)),o(i,{link:"",type:"primary",onClick:H},{default:a(()=>[c(r(t.$t("guide")),1)]),_:1})]),n("div",Fe,[le((u(),k(j,{class:"login-card"},{default:a(()=>[n("h2",Me,r(t.$t("loginToVpadmin")),1),E.value?(u(),m(F,{key:1},[o(Y,{ref_key:"loginFormRef",ref:T,model:l.value,rules:P,class:"login-form"},{default:a(()=>[D.value?(u(),k(p,{key:0,prop:"tenantId"},{default:a(()=>[o(J,{modelValue:l.value.tenantId,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.tenantId=s),filterable:"",placeholder:t.$t("selectOrEnterCompanyName"),style:{width:"100%"}},{default:a(()=>[(u(!0),m(F,null,se(f.value,s=>(u(),k(S,{key:s.tenantId,label:s.companyName,value:s.tenantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1})):M("",!0),o(p,{prop:"username"},{default:a(()=>[o(L,{modelValue:l.value.username,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.username=s),type:"text",placeholder:t.$t("email")},{prefix:a(()=>[o(V,null,{default:a(()=>[o(U(ne))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),o(p,{prop:"password"},{default:a(()=>[o(L,{modelValue:l.value.password,"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.password=s),type:"password",placeholder:t.$t("password"),onKeyup:R(C,["enter"])},{prefix:a(()=>[o(V,null,{default:a(()=>[o(U(re))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),w.value?(u(),k(p,{key:1,prop:"code",class:"verify-code-item"},{default:a(()=>[o(L,{modelValue:l.value.code,"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.code=s),"auto-complete":"off",placeholder:t.$t("verificationCode"),onKeyup:R(C,["enter"])},{prefix:a(()=>[o(V,null,{default:a(()=>[o(U(ie))]),_:1})]),_:1},8,["modelValue","placeholder"]),b.value?(u(),m("img",{key:0,src:b.value,class:"login-code-img",onClick:$},null,8,Re)):M("",!0)]),_:1})):M("",!0),o(p,null,{default:a(()=>[o(Q,{modelValue:l.value.rememberMe,"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.rememberMe=s)},{default:a(()=>[c(r(t.$t("rememberMe")),1)]),_:1},8,["modelValue"])]),_:1}),o(p,null,{default:a(()=>[o(i,{type:"primary",loading:_.value,class:"login-button",onClick:ue(C,["prevent"])},{default:a(()=>[_.value?(u(),m("span",Be,r(t.$t("loggingIn")),1)):(u(),m("span",Ne,r(t.$t("login")),1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),n("div",Ge,[o(i,{class:"link-button",onClick:O},{default:a(()=>[c(" ← "+r(t.$t("otherLoginOptions")),1)]),_:1}),o(i,{class:"link-button forgot-password",onClick:K},{default:a(()=>[c(r(t.$t("forgotPassword")),1)]),_:1})])],64)):(u(),m(F,{key:0},[n("div",Ue,[o(i,{class:"social-button github",onClick:e[0]||(e[0]=s=>y("github"))},{default:a(()=>[e[10]||(e[10]=n("i",{class:"fab fa-github"},null,-1)),c(" "+r(t.$t("continueWithGitHub")),1)]),_:1}),o(i,{class:"social-button gitlab",onClick:e[1]||(e[1]=s=>y("gitlab"))},{default:a(()=>[e[11]||(e[11]=n("i",{class:"fab fa-gitlab"},null,-1)),c(" "+r(t.$t("continueWithGitLab")),1)]),_:1}),o(i,{class:"social-button google",onClick:e[2]||(e[2]=s=>y("google"))},{default:a(()=>[e[12]||(e[12]=n("i",{class:"fab fa-google"},null,-1)),c(" "+r(t.$t("continueWithGoogle")),1)]),_:1}),o(i,{class:"social-button facebook",onClick:e[3]||(e[3]=s=>y("facebook"))},{default:a(()=>[e[13]||(e[13]=n("i",{class:"fab fa-facebook-f"},null,-1)),c(" "+r(t.$t("continueWithFacebook")),1)]),_:1})]),n("div",Te,[n("span",null,r(t.$t("or")),1)]),n("div",qe,[o(i,{class:"link-button email-button",onClick:q},{default:a(()=>[c(r(t.$t("continueWithEmail"))+" → ",1)]),_:1})])],64)),n("div",Pe,[o(i,{class:"link-button signup-button",onClick:z},{default:a(()=>[c(r(t.$t("noAccountSignUp")),1)]),_:1})])]),_:1})),[[X,h.value]])]),n("div",We,[n("span",null,r(t.$t("copyright",{year:new Date().getFullYear()})),1)])])}}}),Xe=he(De,[["__scopeId","data-v-36120374"]]);export{Xe as default};
