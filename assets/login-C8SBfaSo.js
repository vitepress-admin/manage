import{d as G,C as K,u as T,r as d,D,b as O,a2 as H,o as c,c as v,p as t,q as l,m as _,e as s,A as C,F as Q,z as j,i as V,I as L,y as $,L as J,V as P,M as W,N as X,O as Y,E as Z,R as ee,Q as te,S as oe,U as le,x as ae,_ as ne}from"./index-B9_8IJe0.js";import{E as se,a as re}from"./el-form-item-CTbaNcVh.js";import{E as ie}from"./el-checkbox-B0xBIaBW.js";import{a as ue}from"./auth-BL-mzATH.js";import"./_baseClone-CY4Rh9zz.js";import"./_initCloneObject-DrfOwJJW.js";const de={class:"login"},ce={class:"login-code"},me=["src"],pe={key:0},ge={key:1},fe={key:0,style:{float:"right"}},ve=G({__name:"login",setup(_e){const R=K(),E=T(),o=d({tenantId:"000001",username:"",password:"",rememberMe:!1,code:"",uuid:""}),q={tenantId:[{required:!0,trigger:"blur",message:"请输入您的租户编号"}],username:[{required:!0,trigger:"blur",message:"请输入您的账号"}],password:[{required:!0,trigger:"blur",message:"请输入您的密码"}],code:[{required:!0,trigger:"change",message:"请输入验证码"}]},x=d(""),g=d(!1),b=d(!0),I=d(!0),B=d(!1),M=d("/"),U=d(),f=d([]);D(()=>E.currentRoute.value,r=>{M.value=r.query&&decodeURIComponent(r.query.redirect)},{immediate:!0});const y=()=>{var r;(r=U.value)==null||r.validate(async(e,m)=>{if(e){g.value=!0,o.value.rememberMe?(localStorage.setItem("tenantId",String(o.value.tenantId)),localStorage.setItem("username",String(o.value.username)),localStorage.setItem("password",String(o.value.password)),localStorage.setItem("rememberMe",String(o.value.rememberMe))):(localStorage.removeItem("tenantId"),localStorage.removeItem("username"),localStorage.removeItem("password"),localStorage.removeItem("rememberMe"));const[n]=await P(R.login(o.value));if(n)g.value=!1,b.value&&await S();else{const k=M.value||"/";await E.push(k),g.value=!1}}else console.log("error submit!",m)})},S=async()=>{const r=await W(),{data:e}=r;b.value=e.captchaEnabled===void 0?!0:e.captchaEnabled,b.value&&(x.value="data:image/gif;base64,"+e.img,o.value.uuid=e.uuid)},F=()=>{const r=localStorage.getItem("tenantId"),e=localStorage.getItem("username"),m=localStorage.getItem("password"),n=localStorage.getItem("rememberMe");o.value={tenantId:r===null?String(o.value.tenantId):r,username:e===null?String(o.value.username):e,password:String(m===null?o.value.password:m),rememberMe:n===null?!1:!!n}},N=async()=>{const{data:r}=await X();I.value=r.tenantEnabled===void 0?!0:r.tenantEnabled,I.value&&(f.value=r.voList,f.value!=null&&f.value.length!==0&&(o.value.tenantId=f.value[0].tenantId))},u=r=>{ue(r,o.value.tenantId).then(e=>{e.code===Y.SUCCESS?window.location.href=e.data:Z.error(e.msg)})};return O(()=>{S(),N(),F()}),(r,e)=>{const m=ee,n=te,k=oe,p=se,w=le,A=ie,i=ae,h=H("router-link"),z=re;return c(),v("div",de,[t(z,{ref_key:"loginRef",ref:U,model:s(o),rules:q,class:"login-form"},{default:l(()=>[e[16]||(e[16]=_("h3",{class:"title"},"VpAdmin SSG Sites Administrator Management System",-1)),s(I)?(c(),C(p,{key:0,prop:"tenantId"},{default:l(()=>[t(k,{modelValue:s(o).tenantId,"onUpdate:modelValue":e[0]||(e[0]=a=>s(o).tenantId=a),filterable:"",placeholder:"请选择/输入公司名称",style:{width:"100%"}},{prefix:l(()=>[t(n,{"icon-class":"company",class:"el-input__icon input-icon"})]),default:l(()=>[(c(!0),v(Q,null,j(s(f),a=>(c(),C(m,{key:a.tenantId,label:a.companyName,value:a.tenantId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):V("",!0),t(p,{prop:"username"},{default:l(()=>[t(w,{modelValue:s(o).username,"onUpdate:modelValue":e[1]||(e[1]=a=>s(o).username=a),type:"text",size:"large","auto-complete":"off",placeholder:"账号"},{prefix:l(()=>[t(n,{"icon-class":"user",class:"el-input__icon input-icon"})]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"password"},{default:l(()=>[t(w,{modelValue:s(o).password,"onUpdate:modelValue":e[2]||(e[2]=a=>s(o).password=a),type:"password",size:"large","auto-complete":"off",placeholder:"密码",onKeyup:L(y,["enter"])},{prefix:l(()=>[t(n,{"icon-class":"password",class:"el-input__icon input-icon"})]),_:1},8,["modelValue"])]),_:1}),s(b)?(c(),C(p,{key:1,prop:"code"},{default:l(()=>[t(w,{modelValue:s(o).code,"onUpdate:modelValue":e[3]||(e[3]=a=>s(o).code=a),size:"large","auto-complete":"off",placeholder:"验证码",style:{width:"63%"},onKeyup:L(y,["enter"])},{prefix:l(()=>[t(n,{"icon-class":"validCode",class:"el-input__icon input-icon"})]),_:1},8,["modelValue"]),_("div",ce,[_("img",{src:s(x),class:"login-code-img",onClick:S},null,8,me)])]),_:1})):V("",!0),t(A,{modelValue:s(o).rememberMe,"onUpdate:modelValue":e[4]||(e[4]=a=>s(o).rememberMe=a),style:{margin:"0 0 25px 0"}},{default:l(()=>e[14]||(e[14]=[$("记住密码")])),_:1},8,["modelValue"]),t(p,{style:{float:"right"}},{default:l(()=>[t(i,{circle:"",title:"微信登录",onClick:e[5]||(e[5]=a=>u("wechat_open"))},{default:l(()=>[t(n,{"icon-class":"wechat"})]),_:1}),t(i,{circle:"",title:"MaxKey登录",onClick:e[6]||(e[6]=a=>u("maxkey"))},{default:l(()=>[t(n,{"icon-class":"maxkey"})]),_:1}),t(i,{circle:"",title:"TopIam登录",onClick:e[7]||(e[7]=a=>u("topiam"))},{default:l(()=>[t(n,{"icon-class":"topiam"})]),_:1}),t(i,{circle:"",title:"Gitee登录",onClick:e[8]||(e[8]=a=>u("gitee"))},{default:l(()=>[t(n,{"icon-class":"gitee"})]),_:1}),t(i,{circle:"",title:"Github登录",onClick:e[9]||(e[9]=a=>u("github"))},{default:l(()=>[t(n,{"icon-class":"github"})]),_:1}),t(i,{circle:"",title:"Gitlab登录",onClick:e[10]||(e[10]=a=>u("gitlab"))},{default:l(()=>[t(n,{"icon-class":"gitlab"})]),_:1}),t(i,{circle:"",title:"AFDIAN登录",onClick:e[11]||(e[11]=a=>u("afdian"))},{default:l(()=>[t(n,{"icon-class":"afdian"})]),_:1}),t(i,{circle:"",title:"Google登录",onClick:e[12]||(e[12]=a=>u("google"))},{default:l(()=>[t(n,{"icon-class":"google"})]),_:1}),t(i,{circle:"",title:"Facebook登录",onClick:e[13]||(e[13]=a=>u("facebook"))},{default:l(()=>[t(n,{"icon-class":"facebook"})]),_:1})]),_:1}),t(p,{style:{width:"100%"}},{default:l(()=>[t(i,{loading:s(g),size:"large",type:"primary",style:{width:"100%"},onClick:J(y,["prevent"])},{default:l(()=>[s(g)?(c(),v("span",ge,"登 录 中...")):(c(),v("span",pe,"登 录"))]),_:1},8,["loading"]),s(B)?(c(),v("div",fe,[t(h,{class:"link-type",to:"/register"},{default:l(()=>e[15]||(e[15]=[$("立即注册")])),_:1})])):V("",!0)]),_:1})]),_:1},8,["model"]),e[17]||(e[17]=_("div",{class:"el-login-footer"},[_("span",null,"Copyright © 2018-2024 疯狂的狮子Li All Rights Reserved.")],-1))])}}}),Ce=ne(ve,[["__scopeId","data-v-5d13ffcf"]]);export{Ce as default};
