import{ac as E,d as D,ae as v,r,au as M,Q as q,i as G,o as d,c as u,j as p,k as _,y as c,e as h,F as I,x as T,R as k,q as y,p as H,bp as Q,I as x,T as J,N as K}from"./index-BdO_PCud.js";import{E as P}from"./el-link-OUujc6Vs.js";import{E as W}from"./el-upload-DMy8zXIu.js";/* empty css                    */function fe(o){return E({url:"/resource/oss/list",method:"get",params:o})}function X(o){return E({url:"/resource/oss/listByIds/"+o,method:"get"})}function Y(o){return E({url:"/resource/oss/"+o,method:"delete"})}const Z={class:"upload-file"},ee={key:0,class:"el-upload__tip"},le={style:{color:"#f56c6c"}},se={style:{color:"#f56c6c"}},te={class:"el-icon-document"},ae={class:"ele-upload-list__item-content-action"},oe=D({__name:"index",props:{modelValue:{type:[String,Object,Array],default:()=>[]},limit:v.number.def(5),fileSize:v.number.def(5),fileType:v.array.def(["doc","xls","ppt","txt","pdf"]),isShowTip:v.bool.def(!0)},emits:["update:modelValue"],setup(o,{emit:U}){const i=o,{proxy:l}=J(),S=U,f=r(0),g=r([]),V=r("/prod-api"+"/resource/oss/upload"),w=r(M()),n=r([]),z=q(()=>i.isShowTip&&(i.fileType||i.fileSize)),$=r();G(()=>i.modelValue,async e=>{if(e){let t=1,s=[];Array.isArray(e)?s=e:s=(await X(e)).data.map(m=>({name:m.originalName,url:m.url,ossId:m.ossId})),n.value=s.map(a=>(a={name:a.name,url:a.url,ossId:a.ossId},a.uid=a.uid||new Date().getTime()+t++,a))}else return n.value=[],[]},{deep:!0,immediate:!0});const L=e=>{if(i.fileType.length){const t=e.name.split("."),s=t[t.length-1];if(!(i.fileType.indexOf(s)>=0))return l==null||l.$modal.msgError(`文件格式不正确, 请上传${i.fileType.join("/")}格式文件!`),!1}return i.fileSize&&!(e.size/1024/1024<i.fileSize)?(l==null||l.$modal.msgError(`上传文件大小不能超过 ${i.fileSize} MB!`),!1):(l==null||l.$modal.loading("正在上传文件，请稍候..."),f.value++,!0)},O=()=>{l==null||l.$modal.msgError(`上传文件数量不能超过 ${i.limit} 个!`)},C=()=>{l==null||l.$modal.msgError("上传文件失败")},j=(e,t)=>{var s;e.code===200?(g.value.push({name:e.data.fileName,url:e.data.url,ossId:e.data.ossId}),B()):(f.value--,l==null||l.$modal.closeLoading(),l==null||l.$modal.msgError(e.msg),(s=$.value)==null||s.handleRemove(t),B())},F=e=>{let t=n.value[e].ossId;Y(t),n.value.splice(e,1),S("update:modelValue",N(n.value))},B=()=>{f.value>0&&g.value.length===f.value&&(n.value=n.value.filter(e=>e.url!==void 0).concat(g.value),g.value=[],f.value=0,S("update:modelValue",N(n.value)),l==null||l.$modal.closeLoading())},R=e=>e.lastIndexOf("/")>-1?e.slice(e.lastIndexOf("/")+1):e,N=(e,t)=>{let s="";return t=t||",",e.forEach(a=>{a.ossId&&(s+=a.ossId+t)}),s!=""?s.substring(0,s.length-1):""};return(e,t)=>{const s=x,a=W,m=P;return d(),u("div",Z,[p(a,{ref_key:"fileUploadRef",ref:$,multiple:"",action:h(V),"before-upload":L,"file-list":h(n),limit:o.limit,"on-error":C,"on-exceed":O,"on-success":j,"show-file-list":!1,headers:h(w),class:"upload-file-uploader"},{default:_(()=>[p(s,{type:"primary"},{default:_(()=>[c("选取文件")]),_:1})]),_:1},8,["action","file-list","limit","headers"]),h(z)?(d(),u("div",ee,[c(" 请上传 "),o.fileSize?(d(),u(I,{key:0},[c(" 大小不超过 "),T("b",le,k(o.fileSize)+"MB",1)],64)):y("",!0),o.fileType?(d(),u(I,{key:1},[c(" 格式为 "),T("b",se,k(o.fileType.join("/")),1)],64)):y("",!0),c(" 的文件 ")])):y("",!0),p(Q,{class:"upload-file-list el-upload-list el-upload-list--text",name:"el-fade-in-linear",tag:"ul"},{default:_(()=>[(d(!0),u(I,null,H(h(n),(b,A)=>(d(),u("li",{key:b.uid,class:"el-upload-list__item ele-upload-list__item-content"},[p(m,{href:`${b.url}`,underline:!1,target:"_blank"},{default:_(()=>[T("span",te,k(R(b.name)),1)]),_:2},1032,["href"]),T("div",ae,[p(s,{type:"danger",link:"",onClick:ne=>F(A)},{default:_(()=>[c("删除")]),_:2},1032,["onClick"])])]))),128))]),_:1})])}}}),me=K(oe,[["__scopeId","data-v-bcbe3161"]]);export{me as _,fe as a,Y as d,X as l};
