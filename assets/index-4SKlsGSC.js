import{a2 as F,d as Fe,h as De,C as Ie,aa as me,r as b,ab as K,b as Le,ah as Ae,o as s,c as V,p as a,q as n,w as T,m as Q,e as t,I as Z,F as h,z as k,A as $,y as c,t as v,U as de,ag as Be,af as ze,i as ue,a1 as Ke,av as Qe,S as Me,P as Oe,Q as Ge,x as He,ap as Je,ac as We,B as Xe,v as Ye,_ as Ze}from"./index-BoZ_NHcV.js";import{E as xe,a as el}from"./el-descriptions-item-CRE5fEWj.js";/* empty css                  *//* empty css                       *//* empty css                 */import{_ as ll}from"./index-L-2-CD8s.js";import{E as al,a as tl}from"./el-table-column-D7OTia2S.js";import"./el-checkbox-P4CsStjC.js";import{_ as ol}from"./index-C6Yq9PJ4.js";/* empty css               */import{_ as nl}from"./index-CYBAydvN.js";/* empty css               *//* empty css                */import{E as rl,a as il}from"./el-form-item-B1jFSTUI.js";import{g as ml}from"./edit-tgFtVnG9.js";import{E as dl}from"./index-CvM3PS3t.js";import{E as ul}from"./index-7Tbabexq.js";import{E as sl}from"./index-C68px2O7.js";import{E as pl,a as fl}from"./index-BWi2n354.js";import"./_initCloneObject-CC3WSgFr.js";/* empty css                */import"./index-sR6EW1xb.js";import"./_baseClone-tnMM97Jv.js";const cl=_=>F({url:"/vpadmin/paymentConfig/list",method:"get",params:_}),vl=_=>F({url:"/vpadmin/paymentConfig/"+_,method:"get"}),yl=_=>F({url:"/vpadmin/paymentConfig",method:"post",data:_}),se=_=>F({url:"/vpadmin/paymentConfig",method:"put",data:_}),bl=_=>F({url:"/vpadmin/paymentConfig/"+_,method:"delete"}),gl={class:"p-2"},_l={class:"mb-[10px]"},$l={class:"dialog-footer"},Cl={class:"dialog-footer"},Vl={class:"dialog-footer"},Nl=Fe({__name:"index",setup(_){const{t:i}=De(),x=Ie(),{proxy:d}=Ke(),{sys_normal_disable:M,vpa_payment_platform_type:D,vpa_payment_type:I}=me(d==null?void 0:d.useDict("sys_normal_disable","vpa_payment_platform_type","vpa_payment_type")),ee=b([]),O=b(!1),R=b(!0),L=b(!0),le=b([]);b(!0),b(!0);const G=b(0),ae=b(),H=b(),J=b([]),g=K({visible:!1,title:"",isEdit:!1}),f=K({visible:!1,data:{}}),te={id:void 0,projectId:void 0,projectName:void 0,paymentName:void 0,platform:void 0,paymentType:void 0,tierName:void 0,autoSend:"1",subject:void 0,emailFrom:void 0,emailContent:void 0,verificationToken:void 0},S=K({visible:!1,form:{email:""},rules:{email:[{required:!0,message:i("senderAddressRequired"),trigger:"blur"},{type:"email",message:i("invalidEmail"),trigger:"blur"}]}}),oe=b(),pe=()=>{var e;(e=oe.value)==null||e.validate(o=>{o&&(m.value.emailFrom=S.form.email,S.visible=!1)})},fe=K({form:{...te},queryParams:{pageNum:1,pageSize:10,projectName:void 0,paymentName:void 0,platform:void 0,paymentType:void 0,tierName:void 0,autoSend:void 0,params:{}},rules:{projectId:[{required:!0,message:i("projectIdRequired"),trigger:"blur"}],paymentName:[{required:!0,message:i("paymentNameRequired"),trigger:"blur"}],platform:[{required:!0,message:i("paymentPlatformRequired"),trigger:"change"}],verificationToken:[{required:!0,message:i("verificationTokenRequired"),trigger:"blur"}],paymentType:[{required:!0,message:i("paymentTypeRequired"),trigger:"change"}],autoSend:[{required:!0,message:i("autoSendEmailRequired"),trigger:"blur"}],tierName:[{required:!0,message:i("userLevelRequired"),trigger:"blur",validator:(e,o,r)=>{m.value.paymentType==="2"&&!o?r(new Error(i("userLevelRequired"))):r()}}],emailFrom:[{required:!0,message:i("senderAddressRequired"),trigger:"blur",validator:(e,o,r)=>{m.value.autoSend==="0"&&!o?r(new Error(i("senderAddressRequired"))):r()}}],subject:[{required:!0,message:i("emailSubjectRequired"),trigger:"blur",validator:(e,o,r)=>{m.value.autoSend==="0"&&!o?r(new Error(i("emailSubjectRequired"))):r()}}],emailContent:[{required:!0,message:i("emailContentRequired"),trigger:"blur",validator:(e,o,r)=>{m.value.autoSend==="0"&&!o?r(new Error(i("emailContentRequired"))):r()}}]}}),{queryParams:u,form:m,rules:ce}=me(fe),j=async()=>{R.value=!0;try{const e=await cl(u.value);ee.value=e.rows,G.value=e.total}catch(e){console.error(i("failedToFetchList"),e)}finally{R.value=!1}},ve=e=>{A(),W();const o={...e,id:void 0,projectId:e.projectId,projectName:e.projectName,paymentName:`${e.paymentName}_copy`,platform:e.platform,paymentType:e.paymentType,tierName:e.tierName,autoSend:e.autoSend,subject:e.subject,emailFrom:x.email,emailContent:e.emailContent,verificationToken:e.verificationToken};Object.assign(m.value,o),g.visible=!0,g.title=i("addPaymentConfigInfo")},W=async()=>{try{const e=await ml();J.value=e.data}catch(e){console.error(i("failedToFetchProjectList"),e)}},ye=()=>{A(),g.visible=!1},A=()=>{var e;m.value={...te},m.value.tierName=void 0,(e=H.value)==null||e.resetFields()},q=()=>{u.value.pageNum=1,j()},be=()=>{var e;(e=ae.value)==null||e.resetFields(),q()},ge=e=>{const o=J.value.find(r=>r.id===e);o&&(m.value.projectName=o.projectName)},_e=async(e,o)=>{try{const r=i(o==="0"?"confirmEnableConfig":"confirmDisableConfig");await Qe.confirm(r,i("confirmInfo"),{confirmButtonText:i("confirm"),cancelButtonText:i("cancel"),type:"warning"}),await se({...e,autoSend:o}),d==null||d.$modal.msgSuccess(i("updateSuccessful"))}catch(r){console.error(i("failedToUpdateAutoSendStatus"),r),e.autoSend=o==="0"?"1":"0",r instanceof Error&&r.message!=="cancel"&&(d==null||d.$modal.msgError(i("updateFailed")))}},$e=e=>{f.data={...e},f.visible=!0},Ce=()=>{A(),W(),m.value.emailFrom=x.email,g.visible=!0,g.title=i("addPaymentConfigInfo")},Ve=async e=>{A(),await W();const o=(e==null?void 0:e.id)||le.value[0];try{const r=await vl(o);Object.assign(m.value,r.data),g.visible=!0,g.title=i("editPaymentConfigInfo")}catch(r){console.error(i("failedToFetchConfigDetails"),r),d==null||d.$modal.msgError(i("failedToFetchConfigDetails"))}},Ne=()=>{var e;(e=H.value)==null||e.validate(async o=>{if(o){O.value=!0;try{m.value.id?await se(m.value):await yl(m.value),d==null||d.$modal.msgSuccess(i("operationSuccessful")),g.visible=!1,await j()}catch(r){console.error(i("operationFailed"),r),d==null||d.$modal.msgError(i("operationFailed"))}finally{O.value=!1}}})},he=async e=>{const o=(e==null?void 0:e.id)||le.value;try{await(d==null?void 0:d.$modal.confirm(i("confirmDeletePaymentConfig",{name:e.projectName+"-"+e.paymentName}))),R.value=!0,await bl(o),d==null||d.$modal.msgSuccess(i("deleteSuccessful")),await j()}catch(r){console.error(i("deleteFailed"),r),r instanceof Error&&r.message!=="cancel"&&(d==null||d.$modal.msgError(i("deleteFailed")))}finally{R.value=!1}};return Le(()=>{j()}),(e,o)=>{var re,ie;const r=Me,p=rl,w=Oe,P=Ge,y=He,X=il,ne=dl,Se=ul,Ee=nl,Te=sl,N=al,U=ol,ke=Je,B=We,je=tl,we=ll,Pe=pl,Re=fl,Y=Xe,C=xe,qe=el,z=Ae("hasPermi"),Ue=Ye;return s(),V("div",gl,[a(Be,{"enter-active-class":(re=t(d))==null?void 0:re.animate.searchAnimate.enter,"leave-active-class":(ie=t(d))==null?void 0:ie.animate.searchAnimate.leave},{default:n(()=>[T(Q("div",_l,[a(ne,{shadow:"hover"},{default:n(()=>[a(X,{ref_key:"queryFormRef",ref:ae,model:t(u),inline:!0,"label-width":"auto"},{default:n(()=>[a(p,{label:e.$t("projectName"),prop:"projectName"},{default:n(()=>[a(r,{modelValue:t(u).projectName,"onUpdate:modelValue":o[0]||(o[0]=l=>t(u).projectName=l),placeholder:e.$t("enterProjectName"),clearable:"",onKeyup:Z(q,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("paymentName"),prop:"paymentName"},{default:n(()=>[a(r,{modelValue:t(u).paymentName,"onUpdate:modelValue":o[1]||(o[1]=l=>t(u).paymentName=l),placeholder:e.$t("enterPaymentName"),clearable:"",onKeyup:Z(q,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("paymentPlatform"),prop:"platform"},{default:n(()=>[a(P,{modelValue:t(u).platform,"onUpdate:modelValue":o[2]||(o[2]=l=>t(u).platform=l),placeholder:e.$t("selectPaymentPlatform"),clearable:""},{default:n(()=>[(s(!0),V(h,null,k(t(D),l=>(s(),$(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("paymentType"),prop:"paymentType"},{default:n(()=>[a(P,{modelValue:t(u).paymentType,"onUpdate:modelValue":o[3]||(o[3]=l=>t(u).paymentType=l),placeholder:e.$t("selectPaymentType"),clearable:""},{default:n(()=>[(s(!0),V(h,null,k(t(I),l=>(s(),$(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("userLevel"),prop:"tierName"},{default:n(()=>[a(r,{modelValue:t(u).tierName,"onUpdate:modelValue":o[4]||(o[4]=l=>t(u).tierName=l),placeholder:e.$t("enterUserLevel"),clearable:"",onKeyup:Z(q,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("autoReply"),prop:"status"},{default:n(()=>[a(P,{modelValue:t(u).autoSend,"onUpdate:modelValue":o[5]||(o[5]=l=>t(u).autoSend=l),placeholder:e.$t("pleaseSelect"),clearable:""},{default:n(()=>[(s(!0),V(h,null,k(t(M),l=>(s(),$(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,null,{default:n(()=>[a(y,{type:"primary",icon:"Search",onClick:q},{default:n(()=>[c(v(e.$t("search")),1)]),_:1}),a(y,{icon:"Refresh",onClick:be},{default:n(()=>[c(v(e.$t("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[de,t(L)]])]),_:1},8,["enter-active-class","leave-active-class"]),a(ne,{shadow:"never"},{header:n(()=>[a(Te,{gutter:10,class:"mb8"},{default:n(()=>[a(Se,{span:1.5},{default:n(()=>[T((s(),$(y,{type:"primary",plain:"",icon:"Plus",onClick:Ce},{default:n(()=>[c(v(e.$t("add")),1)]),_:1})),[[z,["vpadmin:paymentConfig:add"]]])]),_:1}),a(Ee,{showSearch:t(L),"onUpdate:showSearch":o[6]||(o[6]=l=>ze(L)?L.value=l:null),onQueryTable:j},null,8,["showSearch"])]),_:1})]),default:n(()=>[T((s(),$(je,{data:t(ee)},{default:n(()=>[a(N,{label:e.$t("projectName"),align:"center",prop:"projectName"},null,8,["label"]),a(N,{label:e.$t("paymentName"),align:"center",prop:"paymentName"},null,8,["label"]),a(N,{label:e.$t("paymentPlatform"),align:"center",prop:"platform"},{default:n(l=>[a(U,{options:t(D),value:l.row.platform},null,8,["options","value"])]),_:1},8,["label"]),a(N,{label:e.$t("verificationToken"),align:"center",prop:"verificationToken"},null,8,["label"]),a(N,{label:e.$t("paymentType"),align:"center",prop:"paymentType"},{default:n(l=>[a(U,{options:t(I),value:l.row.paymentType},null,8,["options","value"])]),_:1},8,["label"]),a(N,{label:e.$t("userLevel"),align:"center",prop:"tierName"},null,8,["label"]),a(N,{key:"status",label:e.$t("autoReply"),align:"center"},{default:n(l=>[a(ke,{modelValue:l.row.autoSend,"onUpdate:modelValue":E=>l.row.autoSend=E,"active-value":"0","inactive-value":"1",onChange:E=>_e(l.row,E)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),a(N,{label:e.$t("operations"),align:"center","class-name":"small-padding fixed-width",width:"140px"},{default:n(l=>[a(B,{content:e.$t("details"),placement:"top"},{default:n(()=>[a(y,{link:"",type:"primary",icon:"View",onClick:E=>$e(l.row)},null,8,["onClick"])]),_:2},1032,["content"]),a(B,{content:e.$t("edit"),placement:"top"},{default:n(()=>[T(a(y,{link:"",type:"primary",icon:"Edit",onClick:E=>Ve(l.row)},null,8,["onClick"]),[[z,["vpadmin:paymentConfig:edit"]]])]),_:2},1032,["content"]),a(B,{content:e.$t("copy"),placement:"top"},{default:n(()=>[T(a(y,{link:"",type:"primary",icon:"CopyDocument",onClick:E=>ve(l.row)},null,8,["onClick"]),[[z,["vpadmin:paymentConfig:add"]]])]),_:2},1032,["content"]),a(B,{content:e.$t("delete"),placement:"top"},{default:n(()=>[T(a(y,{link:"",type:"primary",icon:"Delete",onClick:E=>he(l.row)},null,8,["onClick"]),[[z,["vpadmin:paymentConfig:remove"]]])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data"])),[[Ue,t(R)]]),T(a(we,{page:t(u).pageNum,"onUpdate:page":o[7]||(o[7]=l=>t(u).pageNum=l),limit:t(u).pageSize,"onUpdate:limit":o[8]||(o[8]=l=>t(u).pageSize=l),total:t(G),onPagination:j},null,8,["page","limit","total"]),[[de,t(G)>0]])]),_:1}),a(Y,{modelValue:t(g).visible,"onUpdate:modelValue":o[18]||(o[18]=l=>t(g).visible=l),title:t(g).title,width:"500px","append-to-body":""},{footer:n(()=>[Q("div",$l,[a(y,{loading:t(O),type:"primary",onClick:Ne},{default:n(()=>[c(v(e.$t("confirm")),1)]),_:1},8,["loading"]),a(y,{onClick:ye},{default:n(()=>[c(v(e.$t("cancel")),1)]),_:1})])]),default:n(()=>[a(X,{ref_key:"paymentConfigFormRef",ref:H,model:t(m),rules:t(ce),"label-width":"150px"},{default:n(()=>[a(p,{label:e.$t("projectName"),prop:"projectId"},{default:n(()=>[a(P,{modelValue:t(m).projectId,"onUpdate:modelValue":o[9]||(o[9]=l=>t(m).projectId=l),placeholder:e.$t("pleaseSelectProject"),onChange:ge},{default:n(()=>[(s(!0),V(h,null,k(t(J),l=>(s(),$(w,{key:l.id,label:l.projectName,value:l.id,disabled:l.isAdmin==="N"},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("paymentName"),prop:"paymentName"},{default:n(()=>[a(r,{modelValue:t(m).paymentName,"onUpdate:modelValue":o[10]||(o[10]=l=>t(m).paymentName=l),placeholder:e.$t("pleaseEnterPaymentName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("paymentPlatform"),prop:"platform"},{default:n(()=>[a(P,{modelValue:t(m).platform,"onUpdate:modelValue":o[11]||(o[11]=l=>t(m).platform=l),placeholder:e.$t("pleaseSelectPaymentPlatform")},{default:n(()=>[(s(!0),V(h,null,k(t(D),l=>(s(),$(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("verificationToken"),prop:"verificationToken"},{default:n(()=>[a(r,{modelValue:t(m).verificationToken,"onUpdate:modelValue":o[12]||(o[12]=l=>t(m).verificationToken=l),placeholder:e.$t("pleaseEnterVerificationToken")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("paymentType"),prop:"paymentType"},{default:n(()=>[a(P,{modelValue:t(m).paymentType,"onUpdate:modelValue":o[13]||(o[13]=l=>t(m).paymentType=l),placeholder:e.$t("pleaseSelectPaymentType")},{default:n(()=>[(s(!0),V(h,null,k(t(I),l=>(s(),$(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(m).paymentType==="2"?(s(),$(p,{key:0,label:e.$t("userLevel"),prop:"tierName"},{default:n(()=>[a(r,{modelValue:t(m).tierName,"onUpdate:modelValue":o[14]||(o[14]=l=>t(m).tierName=l),placeholder:e.$t("pleaseEnterUserLevel")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):ue("",!0),a(p,{label:e.$t("autoReply"),prop:"autoSend"},{default:n(()=>[a(Re,{modelValue:t(m).autoSend,"onUpdate:modelValue":o[15]||(o[15]=l=>t(m).autoSend=l)},{default:n(()=>[(s(!0),V(h,null,k(t(M),l=>(s(),$(Pe,{key:l.value,value:l.value},{default:n(()=>[c(v(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(m).autoSend==="0"?(s(),V(h,{key:1},[a(p,{label:e.$t("emailSubject"),prop:"subject"},{default:n(()=>[a(r,{modelValue:t(m).subject,"onUpdate:modelValue":o[16]||(o[16]=l=>t(m).subject=l),placeholder:e.$t("pleaseEnterEmailSubject")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:e.$t("emailContent"),prop:"emailContent"},{default:n(()=>[a(r,{modelValue:t(m).emailContent,"onUpdate:modelValue":o[17]||(o[17]=l=>t(m).emailContent=l),type:"textarea",rows:5,autosize:{minRows:5,maxRows:10},placeholder:e.$t("emailContentPlaceholder"),style:{height:"100px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):ue("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(Y,{modelValue:t(S).visible,"onUpdate:modelValue":o[20]||(o[20]=l=>t(S).visible=l),title:e.$t("editSenderEmail"),width:"400px","append-to-body":""},{footer:n(()=>[Q("div",Cl,[a(y,{onClick:o[19]||(o[19]=l=>t(S).visible=!1)},{default:n(()=>[c(v(e.$t("cancel")),1)]),_:1}),a(y,{type:"primary",onClick:pe},{default:n(()=>[c(v(e.$t("confirm")),1)]),_:1})])]),default:n(()=>[a(X,{ref_key:"emailFormRef",ref:oe,model:t(S).form,rules:t(S).rules,"label-width":"0"},null,8,["model","rules"])]),_:1},8,["modelValue","title"]),a(Y,{modelValue:t(f).visible,"onUpdate:modelValue":o[23]||(o[23]=l=>t(f).visible=l),title:e.$t("paymentConfigDetails"),width:"600px"},{footer:n(()=>[Q("div",Vl,[a(y,{onClick:o[22]||(o[22]=l=>t(f).visible=!1)},{default:n(()=>[c(v(e.$t("close")),1)]),_:1})])]),default:n(()=>[a(qe,{column:1,border:""},{default:n(()=>[a(C,{label:e.$t("projectName")},{default:n(()=>[c(v(t(f).data.projectName),1)]),_:1},8,["label"]),a(C,{label:e.$t("paymentName")},{default:n(()=>[c(v(t(f).data.paymentName),1)]),_:1},8,["label"]),a(C,{label:e.$t("paymentPlatform")},{default:n(()=>[a(U,{options:t(D),value:t(f).data.platform},null,8,["options","value"])]),_:1},8,["label"]),a(C,{label:e.$t("verificationToken")},{default:n(()=>[c(v(t(f).data.verificationToken),1)]),_:1},8,["label"]),a(C,{label:e.$t("paymentType")},{default:n(()=>[a(U,{options:t(I),value:t(f).data.paymentType},null,8,["options","value"])]),_:1},8,["label"]),a(C,{label:e.$t("userLevel")},{default:n(()=>[c(v(t(f).data.tierName),1)]),_:1},8,["label"]),a(C,{label:e.$t("autoReply")},{default:n(()=>[a(U,{options:t(M),value:t(f).data.autoSend},null,8,["options","value"])]),_:1},8,["label"]),a(C,{label:e.$t("emailSubject")},{default:n(()=>[c(v(t(f).data.subject),1)]),_:1},8,["label"]),a(C,{label:e.$t("emailContent")},{default:n(()=>[a(r,{modelValue:t(f).data.emailContent,"onUpdate:modelValue":o[21]||(o[21]=l=>t(f).data.emailContent=l),type:"textarea",rows:5,readonly:"",autosize:{minRows:3,maxRows:10}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])])}}}),Hl=Ze(Nl,[["__scopeId","data-v-9e94d55b"]]);export{Hl as default};
