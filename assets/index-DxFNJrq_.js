import{a2 as x,d as j,h as z,C as ae,r as g,k as te,D as le,b as M,as as oe,o as p,c as N,p as t,q as l,A as k,aj as F,m as u,t as h,e as E,dz as ne,y as U,dA as se,dB as ie,i as I,w as re,E as d,x as R,ac as A,R as me,B as de,v as ce,_ as pe,ap as ue}from"./index-B3LzELiE.js";import{E as fe,a as ye}from"./el-form-item-BL_RYDRY.js";/* empty css                  */import{a as $}from"./index-DRJHIvgo.js";import{P as ve,a as ge}from"./PaymentByGiftcard-Bta13AF2.js";import"./_baseClone-CDjyL11X.js";import"./_initCloneObject-BxBlDzv5.js";/* empty css                          *//* empty css               *//* empty css               *//* empty css                */import"./el-checkbox-xPRdhUat.js";import"./index-BSv0mnWi.js";import"./index-B9TfFlAG.js";import"./index-DnBWqAwp.js";import"./index-4jGLAhTF.js";import"./index-D3ewx8iR.js";const he=()=>x({url:"/vpadmin/globalSettings",method:"get"}),_e=C=>x({url:"/vpadmin/globalSettings",method:"post",data:C}),be=C=>x({url:"/vpadmin/globalSettings",method:"put",data:C}),Ce={class:"pro-text-small"},ke={class:"pro-text"},Se={id:"user-guide",class:"user-guide"},we={class:"user-guide-email"},Te=["element-loading-text"],Ee=["src"],Pe=["innerHTML"],Ie=j({__name:"ThemeOrderDialog",props:{paymentPlatform:{},paymentType:{},iframeUrl:{},paymentName:{},projectId:{},size:{default:"default"},text:{default:"Support Me"},planExpired:{type:Boolean,default:!0}},emits:["payment-success","payment-cancelled"],setup(C,{emit:f}){const{t:o}=z(),S="436efb388d684aadab73ef3cbba8f287",y=ae(),e=C,w=f,i=g(!1),n=g(!1),r=g(!0),D=g(null),T=g(e.iframeUrl),v=g(!1),m=g(!1),_=te(()=>e.paymentType==="giftcard"),P=()=>{T.value=`${e.iframeUrl}${e.iframeUrl.includes("?")?"&":"?"}timestamp=${Date.now()}`,r.value=!0},L=()=>{_.value?m.value=!0:(i.value=!0,P())},H=()=>{_.value?m.value=!1:v.value=!0},O=a=>{const s={paymentType:e.paymentType,paymentPlatform:e.paymentPlatform,paymentName:e.paymentName,paymentConfirm:"1",paymentLink:e.iframeUrl,userEmail:a||y.email,projectId:e.projectId,clientId:S};$(s).then(()=>{d.success(o("paymentConfirmRecordAdded")),w("payment-success"),i.value=!1}).catch(c=>{console.error(o("addPaymentConfirmRecordFailed"),c),d.error(o("addPaymentConfirmRecordFailedTryAgain"))})},q=()=>{const a={paymentType:e.paymentType,paymentPlatform:e.paymentPlatform,paymentName:e.paymentName,paymentConfirm:"0",paymentLink:e.iframeUrl,userEmail:y.email,projectId:e.projectId,clientId:S};$(a).then(()=>{w("payment-cancelled")}).catch(s=>{}).finally(()=>{i.value=!1,v.value=!1})},J=()=>{r.value=!1},K=()=>{r.value=!1,d.error(o("loadUpgradePageFailed"))},Q=()=>{navigator.clipboard.writeText(y.email).then(()=>{d.success(o("emailCopiedToClipboard"))}).catch(()=>{d.error(o("copyFailedPleaseManualCopy"))})},W=()=>{n.value=!0},X=()=>{i.value=!1,m.value=!0},Y=()=>{_.value||(i.value=!0,P()),m.value=!1},Z=(a,s)=>{r.value=!0;const c={paymentType:"giftcard",paymentPlatform:e.paymentPlatform,paymentName:e.paymentName,paymentConfirm:"1",paymentLink:e.iframeUrl,userEmail:y.email,projectId:e.projectId,clientId:S,giftCardIds:a,remark:s};$(c).then(()=>{d.success(o("paymentGiftCardSuccess")),w("payment-success")}).catch(V=>{console.error(o("paymentGiftCardFailed"),V),d.error(o("paymentGiftCardFailed"))}).finally(()=>{r.value=!1,i.value=!1,m.value=!1,v.value=!1})};return le(()=>e.paymentType,a=>{a==="giftcard"&&(i.value=!1)}),M(()=>{}),oe(()=>{}),(a,s)=>{const c=R,V=A,G=me,B=de,ee=ce;return p(),N("div",null,[t(V,{content:e.paymentName,placement:"top","show-after":300,effect:"light"},{default:l(()=>[a.size==="small"?(p(),k(c,{key:0,class:F(["pro-button-small",{"pro-button-active":!a.planExpired}]),onClick:L},{default:l(()=>[u("span",Ce,h(e.text),1)]),_:1},8,["class"])):(p(),k(c,{key:1,class:F(["pro-button",{"pro-button-active":!a.planExpired}]),onClick:L},{default:l(()=>[u("span",ke,h(e.text),1)]),_:1},8,["class"]))]),_:1},8,["content"]),_.value?I("",!0):(p(),k(B,{key:0,modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=b=>i.value=b),title:e.paymentName,width:"80%","before-close":H,"append-to-body":""},{default:l(()=>[u("div",Se,[u("span",null,h(a.$t("enterEmailGuide")),1),u("span",we,h(E(y).email),1),t(c,{size:"small",class:"copy-button",onClick:Q},{default:l(()=>[t(G,null,{default:l(()=>[t(E(ne))]),_:1}),U(" "+h(a.$t("copy")),1)]),_:1}),t(c,{size:"small",class:"help-button",onClick:W},{default:l(()=>[t(G,null,{default:l(()=>[t(E(se))]),_:1}),U(" "+h(a.$t("help")),1)]),_:1}),a.paymentType==="donation"?(p(),k(c,{key:0,size:"small",type:"success",class:"giftcard-button",onClick:X},{default:l(()=>[t(G,null,{default:l(()=>[t(E(ie))]),_:1}),U(" "+h(a.$t("payByGiftcard")),1)]),_:1})):I("",!0)]),re((p(),N("div",{class:"iframe-container","element-loading-text":a.$t("loading")},[u("iframe",{id:"kofiframe",ref_key:"iframeRef",ref:D,src:T.value,frameborder:"0",class:"pro-iframe",style:{border:"none",width:"100%",padding:"4px",background:"#f9f9f9"},onLoad:J,onError:K},null,40,Ee)],8,Te)),[[ee,r.value]])]),_:1},8,["modelValue","title"])),t(B,{modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=b=>n.value=b),title:a.$t("upgradeStepsDescription"),width:"70%",class:"help-dialog","append-to-body":""},{default:l(()=>[u("div",{class:"help-content",innerHTML:a.$t("helpContent")},null,8,Pe)]),_:1},8,["modelValue","title"]),_.value?I("",!0):(p(),k(ve,{key:1,visible:v.value,"onUpdate:visible":s[2]||(s[2]=b=>v.value=b),"user-email":E(y).email,"payment-name":e.paymentName,onConfirm:O,onCancel:q},null,8,["visible","user-email","payment-name"])),m.value?(p(),k(ge,{key:2,visible:m.value,"onUpdate:visible":s[3]||(s[3]=b=>m.value=b),"show-back-button":a.paymentType==="donation",onBack:Y,onConfirm:Z},null,8,["visible","show-back-button"])):I("",!0)])}}}),De=pe(Ie,[["__scopeId","data-v-9ed82991"]]),Ve={class:"p-2"},Ge={style:{width:"300px"}},Qe=j({__name:"index",setup(C){const{t:f}=z(),o=g({autoSendEmail:"0"});M(async()=>{try{const n=await he();n.data&&(o.value=n.data)}catch(n){console.error(f("failedToFetchGlobalSettings"),n),d.error(f("failedToFetchGlobalSettings"))}});const S=n=>{console.log(f("autoSendEmailChangedTo",{value:n})),y()},y=async()=>{try{o.value.id?await be(o.value):await _e({...o.value}),d.success(f("settingsSavedSuccessfully"))}catch(n){console.error(f("failedToSaveSettings"),n),d.error(f("failedToSaveSettings"))}},e=()=>{},w=()=>{},i=()=>{window.open("http://www.vpadmin.org/prices/prices#purchasing-integrated-private-or-shared-themes","_blank")};return(n,r)=>{const D=ue,T=R,v=A,m=fe,_=ye;return p(),N("div",Ve,[t(_,{model:o.value,"label-width":"180px"},{default:l(()=>[t(m,{label:n.$t("autoSendEmail")},{default:l(()=>[t(D,{modelValue:o.value.autoSendEmail,"onUpdate:modelValue":r[0]||(r[0]=P=>o.value.autoSendEmail=P),"active-value":"1","inactive-value":"0",onChange:S},null,8,["modelValue"]),t(v,{effect:"light"},{content:l(()=>[u("div",Ge,h(n.$t("emailNotification")),1)]),default:l(()=>[t(T,{type:"info",link:"",icon:"InfoFilled",style:{"margin-left":"10px"}})]),_:1})]),_:1},8,["label"]),t(m,{label:n.$t("orderThemeIntegration")},{default:l(()=>[t(De,{"payment-platform":"ko-fi","payment-type":"donation","iframe-url":"https://ko-fi.com/vpadmin/?hidefeed=true&widget=true&embed=true&preview=true","payment-name":"Order Theme Integration","project-id":"1",size:"default",text:"Theme","plan-expired":!0,style:{"margin-left":"5px"},onPaymentSuccess:e,onPaymentCancelled:w}),t(v,{effect:"light"},{content:l(()=>r[1]||(r[1]=[u("div",{style:{width:"300px"}},'Goto "Purchasing Integrated Private or Shared Themes" user guide.',-1)])),default:l(()=>[t(T,{type:"primary",link:"",icon:"link",style:{"margin-left":"10px"},onClick:i})]),_:1})]),_:1},8,["label"])]),_:1},8,["model"])])}}});export{Qe as default};
